# Feature Specification: イベント人数表示機能

**Feature Branch**: `003-event-attendance-count`
**Created**: 2025-11-08
**Status**: Draft
**Input**: User description: "イベント毎の人数がわかるようにしたい"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - イベント一覧で参加状況を一目で把握 (Priority: P1)

一般ユーザーがトップページのイベント一覧を見たときに、各イベントの参加者数、未定者数、欠席者数、合計人数を一目で確認できる。詳細画面に遷移せずに、各イベントの出欠状況の内訳を素早く把握できる。

**Why this priority**: ユーザーが最も頻繁に使用する画面で、参加・未定・欠席の詳細な内訳を即座に確認できることが最優先。これにより、イベントの参加状況を詳細に把握し、自分の出欠判断の参考にできる。

**Independent Test**: トップページを開くだけで、各イベントカードに「◯ X人 △ Y人 ✗ Z人（計W人）」という形式で人数が表示されることを確認できる。他の機能に依存せず、独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** イベント一覧画面を表示している, **When** 複数のイベントが存在し、それぞれに出欠登録がある, **Then** 各イベントカードに「◯ X人 △ Y人 ✗ Z人（計W人）」形式で詳細な人数内訳が表示される
2. **Given** イベント一覧画面を表示している, **When** 出欠登録が一切ないイベントがある, **Then** そのイベントには「◯ 0人 △ 0人 ✗ 0人（計0人）」と表示される
3. **Given** イベント一覧画面を表示している, **When** あるイベントに参加5人、未定3人、欠席2人の登録がある, **Then** そのイベントには「◯ 5人 △ 3人 ✗ 2人（計10人）」と表示される

---

### User Story 2 - イベント詳細で全体集計を確認 (Priority: P2)

イベント詳細画面で、グループ別の集計だけでなく、イベント全体の参加・未定・欠席の人数を確認できる。これにより、グループごとの内訳を見る前に、まずイベント全体の状況を把握できる。

**Why this priority**: 現在はグループ別集計のみで全体像が見えづらいため、全体集計を追加することでユーザー体験が大幅に向上する。ただし、イベント一覧での表示よりは優先度が低い。

**Independent Test**: イベント詳細画面を開いたときに、グループ別集計の上部にイベント全体の集計セクションが表示され、「参加: X人 / 未定: Y人 / 欠席: Z人（計W人）」という形式で表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** イベント詳細画面を表示している, **When** 複数のグループから出欠登録がある, **Then** グループ別集計の上部に「参加: X人 / 未定: Y人 / 欠席: Z人（計W人）」という全体集計が表示される
2. **Given** イベント詳細画面を表示している, **When** 出欠登録が一切ない, **Then** 全体集計には「参加: 0人 / 未定: 0人 / 欠席: 0人（計0人）」と表示される
3. **Given** イベント詳細画面を表示している, **When** 全体集計とグループ別集計を比較する, **Then** 全体集計の各人数がグループ別集計の合計と一致する

---

### User Story 3 - 管理画面で詳細な人数内訳を確認 (Priority: P3)

管理者がイベント管理画面で、各イベントの参加・未定・欠席の詳細な人数内訳を一覧で確認できる。これにより、イベントの追加・編集・削除の判断材料として活用できる。

**Why this priority**: 管理者向けの機能であり、一般ユーザーが使用する画面ではないため、優先度は最も低い。ただし、管理者の意思決定を支援する重要な情報。

**Independent Test**: イベント管理画面を開いたときに、各イベント行に「◯ X人 △ Y人 ✗ Z人（計W人）」という詳細な人数内訳が表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** イベント管理画面を表示している, **When** 複数のイベントが存在する, **Then** 各イベント行に「◯ X人 △ Y人 ✗ Z人（計W人）」形式で詳細な人数が表示される
2. **Given** イベント管理画面を表示している, **When** 出欠登録がないイベントがある, **Then** そのイベントには「◯ 0人 △ 0人 ✗ 0人（計0人）」と表示される
3. **Given** イベント管理画面を表示している, **When** イベントを削除する, **Then** 削除されたイベントの人数表示も一覧から消える

---

### Edge Cases

- 出欠登録が全くないイベントの場合、すべての人数が0として表示される
- 同じメンバーが複数のグループに所属している場合でも、そのメンバーの出欠は1回のみカウントされる（重複カウントしない）
- イベントが削除された後、関連する人数表示も適切に更新される
- 大量のイベント（100件以上）がある場合でも、人数表示のパフォーマンスが劣化しない

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは各イベント（EventDate）に紐づくすべての出欠登録（Attendance）を集計し、参加者数（◯）、未定者数（△）、欠席者数（✗）、合計回答者数を計算できなければならない
- **FR-002**: イベント一覧画面（トップページ）は、各イベントカードに参加・未定・欠席の詳細な人数内訳を「◯ X人 △ Y人 ✗ Z人（計W人）」の形式で表示しなければならない
- **FR-003**: イベント詳細画面は、グループ別集計の上部にイベント全体の集計を「参加: X人 / 未定: Y人 / 欠席: Z人（計W人）」の形式で表示しなければならない
- **FR-004**: イベント管理画面は、各イベント行に参加・未定・欠席の詳細な人数内訳を「◯ X人 △ Y人 ✗ Z人（計W人）」の形式で表示しなければならない
- **FR-005**: 人数集計は出欠ステータス（'◯'=参加、'△'=未定、'✗'=欠席）に基づいて正確に分類されなければならない
- **FR-006**: 出欠登録が存在しないイベントの場合、すべての人数を0として表示しなければならない
- **FR-007**: 同じメンバーが複数のグループに所属している場合でも、そのメンバーの出欠は1回のみカウントされなければならない（重複カウント防止）

### Key Entities

- **EventDate**: イベント情報を表すエンティティ。人数集計の基準単位。
- **Attendance**: 出欠登録を表すエンティティ。eventDateId、memberId、status（◯/△/✗）を持つ。
- **EventTotalSummary**: イベント全体の人数集計結果。totalAttending（参加者数）、totalMaybe（未定者数）、totalNotAttending（欠席者数）、totalResponded（合計回答者数）を含む。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーはイベント一覧画面で、各イベントの参加状況を詳細画面に遷移せずに1秒以内に確認できる
- **SC-002**: イベント詳細画面では、グループ別集計を見る前に、イベント全体の人数を即座に把握できる
- **SC-003**: 管理者はイベント管理画面で、すべてのイベントの詳細な人数内訳を一覧で確認できる
- **SC-004**: 人数集計は常に正確であり、出欠ステータスの変更が即座に反映される（リアルタイム更新）
- **SC-005**: 100件以上のイベントがある場合でも、人数表示の読み込みが2秒以内に完了する
- **SC-006**: ユーザーの90%が「イベントの参加状況がより分かりやすくなった」と感じる
