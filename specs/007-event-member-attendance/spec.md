# Feature Specification: イベント画面 個人別出欠状況表示機能

**Feature Branch**: `007-event-member-attendance`
**Created**: 2025-11-10
**Status**: Draft
**Input**: User description: "イベント画面で個人の出欠状況を表示する機能。グループごとにアコーディオン表示し、展開時に個人名と出欠ステータス（◯/△/✗/-）を表示。フィルタリング（すべて/参加/未定/欠席/未登録）、ソート（名前順/ステータス順）、検索（メンバー名）機能を含む。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - グループメンバーの出欠確認 (Priority: P1)

イベント主催者として、各グループの誰が参加予定で誰が欠席なのかを確認したい。現在はグループごとの人数しか分からないため、個別の出欠状況が不明で困っている。

**Why this priority**: これは最も基本的な機能であり、イベント主催者が参加者を把握するために不可欠。人数だけでなく、具体的に誰が来るのかを知ることで、座席配置や役割分担などの具体的な準備ができる。

**Independent Test**: イベント詳細画面でグループ名をクリックし、そのグループのメンバーリストと各自の出欠ステータス（◯/△/✗/-）が表示されることを確認。未登録メンバーも「-」として表示される。

**Acceptance Scenarios**:

1. **Given** イベント詳細画面を開いている、**When** グループ名をクリックする、**Then** そのグループの全メンバーが名前と出欠ステータスと共に表示される
2. **Given** グループが展開されている、**When** 出欠登録済みのメンバーを確認する、**Then** ◯（参加）、△（未定）、または✗（欠席）のステータスが表示される
3. **Given** グループが展開されている、**When** 出欠未登録のメンバーを確認する、**Then** 「-（未登録）」と表示される
4. **Given** グループが展開されている、**When** グループ名を再度クリックする、**Then** メンバーリストが折りたたまれる

---

### User Story 2 - 特定ステータスのメンバーフィルタリング (Priority: P2)

イベント主催者として、参加者だけ、または欠席者だけなど、特定の出欠状況のメンバーのみを表示したい。全メンバーを見るより、必要な情報だけを素早く確認できるようにしたい。

**Why this priority**: 基本的な閲覧機能（P1）の次に重要な機能。参加者リストだけを印刷したい、欠席者に連絡したいなど、実務上のニーズが高い。

**Independent Test**: フィルタドロップダウンから「参加のみ」を選択し、◯ステータスのメンバーのみが表示されることを確認。他のステータス（△/✗/-）も同様にテスト可能。

**Acceptance Scenarios**:

1. **Given** グループが展開されている、**When** フィルタで「参加のみ」を選択する、**Then** ◯ステータスのメンバーのみが表示される
2. **Given** グループが展開されている、**When** フィルタで「未定のみ」を選択する、**Then** △ステータスのメンバーのみが表示される
3. **Given** グループが展開されている、**When** フィルタで「欠席のみ」を選択する、**Then** ✗ステータスのメンバーのみが表示される
4. **Given** グループが展開されている、**When** フィルタで「未登録のみ」を選択する、**Then** -ステータスのメンバーのみが表示される
5. **Given** フィルタが適用されている、**When** フィルタで「すべて」を選択する、**Then** 全メンバーが表示される

---

### User Story 3 - メンバーのソート (Priority: P3)

イベント主催者として、メンバーリストを名前順またはステータス順で並び替えたい。名前順で特定のメンバーを探したり、ステータス順で参加者をまとめて確認したりできるようにしたい。

**Why this priority**: 便利機能だが、P1とP2がなくても基本的な閲覧は可能。大人数のグループで特に有用。

**Independent Test**: ソート切り替えボタンをクリックし、名前順（五十音順/アルファベット順）とステータス順（◯→△→✗→-）で並び順が変わることを確認。

**Acceptance Scenarios**:

1. **Given** グループが展開されている、**When** 「名前順」を選択する、**Then** メンバーが名前の昇順（五十音順/アルファベット順）で表示される
2. **Given** グループが展開されている、**When** 「ステータス順」を選択する、**Then** メンバーが◯→△→✗→-の順で表示される
3. **Given** ソート設定が変更されている、**When** フィルタを適用する、**Then** フィルタ後のメンバーにソート順が適用される

---

### User Story 4 - メンバー名検索 (Priority: P3)

イベント主催者として、大人数のイベントで特定のメンバーの出欠状況を素早く確認したい。全グループを展開して探すのではなく、名前で検索して該当メンバーだけを表示したい。

**Why this priority**: 大人数イベントでの便利機能。小規模イベントではP1-P2で十分だが、複数グループで数十人以上のメンバーがいる場合に有用。

**Independent Test**: 検索ボックスにメンバー名の一部を入力し、該当するメンバーのみが全グループを横断して表示されることを確認。

**Acceptance Scenarios**:

1. **Given** イベント詳細画面を開いている、**When** 検索ボックスに「田中」と入力する、**Then** 名前に「田中」を含むメンバーのみが全グループから抽出されて表示される
2. **Given** 検索結果が表示されている、**When** 検索文字列を変更する、**Then** リアルタイムで検索結果が更新される
3. **Given** 検索結果が表示されている、**When** 検索ボックスをクリアする、**Then** 全グループの全メンバーが通常表示に戻る
4. **Given** 検索が適用されている、**When** 該当メンバーの所属グループを確認する、**Then** 各メンバーと共にグループ名が表示される

---

### Edge Cases

- **グループにメンバーが0人の場合**: グループは表示するが、展開時に「メンバーがいません」というメッセージを表示
- **全メンバーが未登録の場合**: 全員が「-（未登録）」ステータスで表示される
- **検索結果が0件の場合**: 「該当するメンバーが見つかりません」というメッセージを表示
- **フィルタ適用で表示メンバーが0件の場合**: 「条件に該当するメンバーがいません」というメッセージを表示
- **同姓同名のメンバーがいる場合**: メンバーIDで区別するが、UI上は名前のみ表示（グループで区別可能）
- **メンバー数が非常に多い場合（100人以上）**: 仮想スクロールやページネーションは実装せず、クライアント側で全件表示（パフォーマンスが問題になれば後で対応）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは、イベント詳細画面のグループ別集計セクションを、クリック可能なアコーディオンUIとして表示しなければならない
- **FR-002**: システムは、グループ名クリック時に、そのグループの全メンバーのリスト（名前と出欠ステータス）を展開表示しなければならない
- **FR-003**: システムは、展開されたグループを再度クリックすると、メンバーリストを折りたたまなければならない
- **FR-004**: システムは、出欠登録済みメンバーのステータスを◯（参加）、△（未定）、✗（欠席）のいずれかで表示しなければならない
- **FR-005**: システムは、出欠未登録のメンバーを「-（未登録）」として表示しなければならない
- **FR-006**: システムは、グループの全メンバーを表示しなければならない（登録済み・未登録問わず）
- **FR-007**: システムは、フィルタドロップダウンを提供し、「すべて」「参加のみ」「未定のみ」「欠席のみ」「未登録のみ」を選択可能にしなければならない
- **FR-008**: システムは、フィルタ選択時に、選択されたステータスのメンバーのみを表示しなければならない
- **FR-009**: システムは、フィルタが各グループ内で適用されるようにしなければならない（グループをまたいで適用）
- **FR-010**: システムは、ソート切り替えボタンを提供し、「名前順」と「ステータス順」を選択可能にしなければならない
- **FR-011**: システムは、名前順選択時に、メンバーを名前の昇順（五十音順/アルファベット順）で表示しなければならない
- **FR-012**: システムは、ステータス順選択時に、メンバーを◯→△→✗→-の順で表示しなければならない
- **FR-013**: システムは、検索ボックスを提供し、メンバー名の部分一致検索を可能にしなければならない
- **FR-014**: システムは、検索実行時に、全グループを横断して該当メンバーを抽出表示しなければならない
- **FR-015**: システムは、検索結果に各メンバーの所属グループ名を表示しなければならない
- **FR-016**: システムは、検索文字列の変更時にリアルタイムで検索結果を更新しなければならない
- **FR-017**: システムは、フィルタ・ソート・検索の設定を組み合わせて適用可能にしなければならない（例: 検索結果をフィルタして名前順でソート）
- **FR-018**: システムは、該当メンバーが0件の場合に適切なメッセージを表示しなければならない

### Key Entities

- **Member（メンバー）**: グループに所属する個人。ID、名前、所属グループIDを持つ
- **Attendance（出欠記録）**: 特定のイベント日付に対する特定のメンバーの出欠状況。メンバーID、イベント日付ID、ステータス（◯/△/✗）を持つ
- **MemberAttendanceDetail（メンバー出欠詳細）**: メンバー情報と出欠ステータスを結合したビュー。メンバーID、メンバー名、グループID、グループ名、ステータス（◯/△/✗/null）、登録済みフラグを含む
- **Group（グループ）**: メンバーの所属単位。ID、名前、表示順を持つ

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: イベント主催者が、グループをクリックしてから1秒以内に全メンバーの出欠状況を確認できる
- **SC-002**: システムは100人以上のメンバーがいるイベントでも快適に動作する（レスポンスタイムが3秒以内）
- **SC-003**: フィルタ、ソート、検索の各機能が正しく動作し、ユーザーが期待通りの結果を得られる（機能テストで100%合格）
- **SC-004**: 未登録メンバーも含めて全メンバーが表示され、誰が出欠を登録していないかが一目で分かる
- **SC-005**: アコーディオンの展開/折りたたみがスムーズに動作し、複数グループを同時に開いても問題なく動作する
- **SC-006**: キーボード操作（Tab、Enter、Space）でアコーディオンを操作でき、アクセシビリティ要件を満たす
- **SC-007**: 全機能（アコーディオン、フィルタ、ソート、検索）のユニットテストと統合テストが実装され、すべてパスする
