# Feature Specification: 出欠確認プロトタイプ

**Feature Branch**: `001-attendance-prototype`
**Created**: 2025-11-05
**Updated**: 2025-11-06（データモデル刷新）
**Status**: Completed
**Input**: User description: "プロトタイプの出欠確認アプリ。認証なし、ローカルストレージでデータ管理。全員が管理者でイベント・グループ作成可能。ユーザーはイベントを選び名前を入力して出欠（◯/△/✗）を登録。イベントごと・グループごとの集計表示、出欠履歴表示、登録の編集・削除機能を含む。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - イベントを作成してグループ・メンバーを登録する (Priority: P1)

ユーザーが練習日や本番等のイベント日付を作成し、楽器パートなどのグループとそのメンバーを登録できる。これがアプリの最も基本的な機能で、これだけで最小限の価値を提供できる。

**Why this priority**: アプリのコア機能。イベント作成とメンバー登録ができなければ、このアプリの存在意義がない。最小限のMVP（Minimum Viable Product）として、この機能だけで出欠管理の基本的な価値を提供できる。

**Independent Test**: ユーザーがイベント日付を作成し、グループとメンバーを登録できることを確認する。データがローカルストレージに保存され、ページをリロードしても保持されることを検証する。

**Acceptance Scenarios**:

1. **Given** 管理画面を開いた状態で、**When** ユーザーが「新しいイベントを作成」をクリックし、日付「2025-12-20」、タイトル「練習」、場所「音楽室」を入力して保存する、**Then** イベント一覧に「2025-12-20 - 練習」が表示される
2. **Given** 管理画面のグループ管理で、**When** ユーザーがグループ名「打」を入力して作成する、**Then** グループ一覧に「打」が表示される
3. **Given** グループ「打」を選択した状態で、**When** ユーザーがメンバー名「田中太郎」を入力して登録する、**Then** メンバー一覧に「田中太郎」が表示される
4. **Given** データを登録済みの状態で、**When** ページをリロードする、**Then** 登録したイベント、グループ、メンバー情報が保持されている

---

### User Story 2 - イベント日付ごとの出欠を登録する (Priority: P1)

メンバーが各イベント日付に対して自分の出欠状況（◯/△/✗）を登録できる。メンバーごとにイベントの参加可否を管理できる。

**Why this priority**: イベントとメンバーの登録だけでは価値が限定的。実際の出欠登録ができて初めて、出欠管理アプリとしての価値を提供できる。

**Independent Test**: メンバーがイベント詳細画面から出欠状況を登録し、データがローカルストレージに保存されることを確認する。

**Acceptance Scenarios**:

1. **Given** イベント「2025-12-20 - 練習」の詳細画面を開いた状態で、**When** メンバー「田中太郎」の出欠を「◯」で登録する、**Then** 田中太郎の行に「◯」が表示される
2. **Given** イベント詳細画面で、**When** メンバー「佐藤花子」の出欠を「△」、「鈴木一郎」の出欠を「✗」で登録する、**Then** それぞれの行に「△」「✗」が表示される
3. **Given** 出欠を登録済みの状態で、**When** ページをリロードする、**Then** 登録した出欠情報が保持されている

---

### User Story 3 - イベントごと・グループごとの集計結果を確認する (Priority: P2)

イベント詳細画面で、グループ別の出欠集計（◯/△/✗の人数）を確認できる。誰が参加予定か、グループごとの参加人数を一目で把握できる。

**Why this priority**: 出欠登録の次に重要な機能。集計結果を確認できることで、イベントの規模や各グループ（パート）の参加者数を把握でき、実用的な価値が大きく向上する。

**Independent Test**: 複数のメンバーが出欠を登録した後、イベント詳細画面でグループ別の集計が正しく表示されることを確認する。

**Acceptance Scenarios**:

1. **Given** イベント「2025-12-20 - 練習」に、グループ「打」のメンバー田中太郎（◯）、佐藤花子（△）、グループ「Cla」のメンバー鈴木一郎（✗）、高橋美咲（◯）が登録されている状態で、**When** ユーザーが集計を確認する、**Then** 「打: ◯1人 △1人 ✗0人」「Cla: ◯1人 △0人 ✗1人」と表示される
2. **Given** 集計が表示されている状態で、**When** 新しく出欠を追加する、**Then** 集計結果が更新される（リロード後に最新の集計が表示される）

---

### User Story 4 - 出欠登録を編集・削除する (Priority: P3)

ユーザーが登録済みの出欠状況を後から変更、または削除できる。予定が変わった場合に柔軟に対応できる。

**Why this priority**: 実用性を高める機能だが、MVPとしては必須ではない。出欠の登録と集計ができれば基本的な価値は提供できるが、ユーザー体験を向上させるために追加する。

**Independent Test**: イベント詳細画面で出欠状況を「◯」から「△」に変更できること、または登録を削除できることを確認する。

**Acceptance Scenarios**:

1. **Given** 田中太郎の出欠が「◯」で登録済みの状態で、**When** イベント詳細画面で田中太郎の出欠を「△」に変更する、**Then** 出欠状況が「△」に更新され、集計結果も更新される
2. **Given** 田中太郎の出欠が登録済みの状態で、**When** 田中太郎の出欠を削除する、**Then** 田中太郎の行から出欠状況が削除され、集計結果から除外される

---

### Edge Cases

- **イベント日付が空の場合**: イベント作成時に日付が入力されていない場合、「日付を入力してください」とエラーメッセージを表示する
- **イベントタイトルが空の場合**: イベント作成時にタイトルが入力されていない場合、「タイトルを入力してください」とエラーメッセージを表示する
- **グループ名が空の場合**: グループ作成時にグループ名が入力されていない場合、「グループ名を入力してください」とエラーメッセージを表示する
- **メンバー名が空の場合**: メンバー登録時に名前が入力されていない場合、「名前を入力してください」とエラーメッセージを表示する
- **出欠状況が選択されていない場合**: 出欠登録時に◯/△/✗のいずれも選択されていない場合、「出欠状況を選択してください」とエラーメッセージを表示する
- **ローカルストレージの容量制限**: ブラウザのローカルストレージの容量制限（通常5-10MB）を超える場合、「データの保存に失敗しました」とエラーメッセージを表示する
- **データの破損**: ローカルストレージのデータが破損している場合、初期状態にリセットし、「データを初期化しました」と通知する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは誰でもイベント日付を作成できる機能を提供しなければならない（認証なし、全員が管理者）
- **FR-002**: システムはイベント作成時に日付（必須）、タイトル（必須）、場所（任意）を入力できなければならない
- **FR-003**: システムは作成されたイベントの一覧を表示しなければならない
- **FR-004**: システムは誰でもグループを作成できる機能を提供しなければならない
- **FR-005**: システムはグループ作成時にグループ名（必須）と表示順（必須）、色（任意）を入力できなければならない
- **FR-006**: システムは作成されたグループの一覧を表示しなければならない
- **FR-007**: システムは各グループにメンバーを登録できなければならない
- **FR-008**: システムはメンバー登録時に名前（必須）を入力できなければならない
- **FR-009**: システムはイベント詳細画面で全メンバーの出欠状況を表示しなければならない
- **FR-010**: システムは出欠状況として「◯」（出席）、「△」（未定）、「✗」（欠席）の3つの選択肢を提供しなければならない
- **FR-011**: システムは入力された出欠状況をローカルストレージに保存しなければならない
- **FR-012**: システムはイベントごと・グループごとに「◯」「△」「✗」それぞれの人数を集計して表示しなければならない
- **FR-013**: システムはユーザーが登録済みの出欠を編集できなければならない（出欠状況の変更）
- **FR-014**: システムはユーザーが登録済みの出欠を削除できなければならない
- **FR-015**: システムはページをリロードしてもデータが保持される必要がある（ローカルストレージの永続化）
- **FR-016**: システムは日本語で表示され、日本語の入力をサポートしなければならない
- **FR-017**: システムは入力バリデーションを行い、必須項目が未入力の場合はエラーメッセージを表示しなければならない

### Key Entities

- **イベント日付 (EventDate)**: 練習日や本番などの具体的な日付を表すエンティティ。日付、タイトル、場所、作成日時を持つ。複数の出欠登録を含む。
- **グループ (Group)**: 楽器パート、部署、クラスなど、メンバーの所属を表すエンティティ。グループ名、表示順、色、作成日時を持つ。複数のメンバーを含む。
- **メンバー (Member)**: グループに所属する参加者を表すエンティティ。名前、所属グループ、作成日時を持つ。複数の出欠登録を含む。
- **出欠登録 (Attendance)**: 特定のイベント日付に対するメンバーの出欠状況を表すエンティティ。イベント日付ID、メンバーID、出欠状況（◯/△/✗）、作成日時を持つ。
- **集計結果 (GroupSummary, EventSummary)**: イベントごと・グループごとの集計データを表す。◯の人数、△の人数、✗の人数、合計人数を含む。出欠登録エンティティから動的に算出される。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーはイベント作成、グループ作成、メンバー登録、出欠登録まで2分以内に完了できる
- **SC-002**: システムは100件のイベント日付、10グループ、各グループに20メンバーがあっても、ページの表示とデータの読み込みが3秒以内に完了する
- **SC-003**: ユーザーの90%以上が、説明なしで直感的にイベント・グループ・メンバーを作成し出欠を登録できる
- **SC-004**: 集計結果は常に最新の出欠状況を反映し、データの不整合が発生しない
- **SC-005**: ページをリロードしても、登録したデータが100%保持される
- **SC-006**: モバイル端末（320px幅）からデスクトップ（1920px幅）まで、すべてのデバイスで快適に操作できる
- **SC-007**: 入力エラー発生時、ユーザーは明確なエラーメッセージにより何を修正すべきか即座に理解できる

## Assumptions

- プロトタイプのため、認証機能は実装しない（将来的にはSupabase Authで実装予定）
- データはブラウザのローカルストレージに保存する（将来的にはSupabaseデータベースに移行予定）
- 同じ名前でのメンバー登録を許可する（認証がないため、ユーザーの識別ができない）
- イベント、グループ、メンバーの削除機能はプロトタイプでは実装しない（出欠登録の削除のみ可能）
- 通知機能（出欠登録時の通知など）はプロトタイプでは実装しない
- ローカルストレージの容量は十分にあると仮定する（通常5-10MBで、このプロトタイプの用途では十分）
- 日本語のみをサポートし、多言語対応は将来的な拡張とする
- イベント日付は個別の日付として管理し、繰り返しイベントの機能は実装しない

## Out of Scope

以下の機能はこのプロトタイプの範囲外とし、将来のイテレーションで実装する：

- ユーザー認証とログイン機能
- イベント、グループ、メンバーの削除機能
- 出欠登録の締切設定
- 通知機能（メール、プッシュ通知）
- CSVエクスポート機能
- データのクラウド同期（Supabaseへの移行）
- 管理者と一般ユーザーの権限分離
- イベントへの招待機能
- コメント・メモ機能
- 繰り返しイベントの設定
- イベントカレンダー表示
